# !bin/bash
#
#	Automatically pushes to the server
#

#this is all superfluous but i was messing around
txtblk='\e[0;30m' # Black - Regular
txtred='\e[0;31m' # Red
txtgrn='\e[0;32m' # Green
txtylw='\e[0;33m' # Yellow
txtblu='\e[0;34m' # Blue
txtpur='\e[0;35m' # Purple
txtcyn='\e[0;36m' # Cyan
txtwht='\e[0;37m' # White
figlet --gay "backend"
figlet --gay "code"
figlet --gay "update"
echo "updates server from main branch. It just updates the functional backend ruby code"
echo -e "${txtcyn}- does not update gems"
echo "- does not update javascript"
echo "- does not update css"
echo "- does not update images"
figlet --gay \- \- \- \- \- \-

#this bit pushes production up, then switches back to main
git add ../*
git commit -m 'pushing main to server'
git checkout production
git merge main
git push
git checkout main

#refresh the scripts and env variables
scp -r ../vm_utils "root@$1:~"
scp -r ../private "root@$1:~"

#run the script on the server
sleep 1
ssh "root@$1" /root/vm_utils/warning_refresh_server_1

figlet --gay "DONE"

#confirm the current branch (gotta know if it fails)
echo "You are currently in the green branch below"
git branch -a 
